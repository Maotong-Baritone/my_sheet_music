<!doctype html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>äºèŒ‚åŒçš„ä¹è°±åº“ | æµ‹è¯•ç‰ˆ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { 
            background-color: #f4f6f9; 
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .container { flex: 1; }
        
        .hero-section {
            background: linear-gradient(135deg, #2c3e50 0%, #4ca1af 100%);
            padding: 3rem 0 5rem 0;
            margin-bottom: -3rem;
            color: white;
            text-align: center;
        }

        .category-card {
            border: none;
            border-radius: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
            height: 100%;
            background: white;
            overflow: hidden;
        }
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .cat-header {
            padding: 1rem;
            font-weight: bold;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .content-section { margin-top: 2rem; }
        .hover-row:hover { background-color: #f1f3f5; cursor: pointer; }
        
        /* ä¾§è¾¹æ è®¡æ•°å¾½ç«  (ä¿æŒæ·¡è‰²) */
        .count-badge { font-size: 0.75rem; opacity: 0.7; }
        
        footer {
            background-color: #2c3e50;
            color: #bdc3c7;
            padding: 3rem 0;
            margin-top: 5rem;
        }
        
        .list-group-item.active-cat {
            background-color: #e9ecef;
            color: #000;
            font-weight: bold;
            border-left: 4px solid #4ca1af;
        }

        /* === ğŸµ æ–°å¢ï¼šä¹è°±åˆ†ç±»ä¸“å±é¢œè‰²æ ‡ç­¾ === */
        .badge-custom {
            font-weight: normal;
            letter-spacing: 0.5px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        /* ğŸ”´ æ­Œå‰§å’å¹è°ƒï¼šçº¢è‰² */
        .badge-opera { background-color: #e63946; color: white; }
        
        /* ğŸ”µ è‰ºæœ¯æ­Œæ›²ï¼šè“è‰² */
        .badge-artsong { background-color: #457b9d; color: white; }
        
        /* ğŸŸ£ å®—æ•™å’å¹è°ƒ (æ¸…å”±å‰§/åº·å¡”å¡”)ï¼šç´«è‰² */
        .badge-sacred { background-color: #7b2cbf; color: white; }
        
        /* ğŸŒˆ é‡å”±ï¼šå½©è‰²æ¸å˜ (æ©˜çº¢åˆ°ç´«) */
        .badge-ensemble { 
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
            color: white; 
            border: none;
            font-weight: bold;
        }
        
        /* ğŸŸ¢ åˆå”±ï¼šç»¿è‰² */
        .badge-choral { background-color: #2a9d8f; color: white; }
        
        /* ğŸŸ  å™¨ä¹ï¼šæ©™è‰² */
        .badge-inst { background-color: #fb8500; color: white; }
        
        /* âš« æ€»è°±ï¼šæ·±è‰² */
        .badge-score { background-color: #343a40; color: white; }
        
        /* âšª å…¶ä»–ï¼šç°è‰² */
        .badge-other { background-color: #6c757d; color: white; }

    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm" style="background: linear-gradient(to right, #2c3e50, #4ca1af); z-index: 100;">
        <div class="container">
            <span class="navbar-brand mb-0 h1 fw-bold">ğŸ¹ äºèŒ‚åŒçš„ä¹è°±åº“</span>
            <div class="d-flex align-items-center gap-3">
                <button class="btn btn-sm btn-outline-light rounded-pill" onclick="showLogModal()">
                    ğŸ”” ç½‘ç«™åŠ¨æ€
                </button>
                <div class="text-end">
                    <span class="badge bg-warning text-dark me-2">Beta v3.5</span>
                    <span class="navbar-text text-white-50 small d-none d-md-block" style="font-size: 0.8rem;">
                        By Yu Maotong
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <div class="hero-section shadow-sm">
        <div class="container">
            <h1 class="fw-bold mb-2">æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¹è°±å…¸è—</h1>
            <p class="text-white-50 mb-4">Sharing music, preserving art.</p>
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <div class="input-group input-group-lg shadow">
                        <span class="input-group-text bg-white border-0">ğŸ”</span>
                        <input type="text" id="searchInput" class="form-control border-0" placeholder="æœç´¢æ›²åã€ä½œå“å·ã€ä½œæ›²å®¶..." style="box-shadow: none;">
                    </div>
                    <div class="mt-4 d-flex flex-column align-items-center gap-2">
                        <button class="btn btn-outline-light rounded-pill px-4 shadow-sm" onclick="resetFilters()">
                            ğŸŒŸ æŸ¥çœ‹å®Œæ•´ä¹è°±åˆ—è¡¨ (View All)
                        </button>
                        <div class="d-flex gap-3 text-white-50 mt-2 small">
                            <span>ğŸ“š æ”¶å½•ï¼š<span id="statTotal" class="text-white fw-bold">0</span> é¦–</span>
                            <span>ğŸ‘¤ ä½œæ›²å®¶ï¼š<span id="statComposer" class="text-white fw-bold">0</span> ä½</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container position-relative" style="z-index: 10;">
        <div class="row g-4">
            
            <div class="col-lg-4 col-md-6">
                <div class="category-card shadow-sm">
                    <div class="cat-header bg-primary bg-opacity-10 text-primary">
                        ğŸ¤ å£°ä¹ä½œå“ (Vocal)
                    </div>
                    <div class="list-group list-group-flush category-group">
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('æ­Œå‰§å’å¹è°ƒ', this)">
                            æ­Œå‰§å’å¹è°ƒ <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="æ­Œå‰§å’å¹è°ƒ">0</span>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('æ¸…å”±å‰§å’å¹è°ƒ', this)">
                            æ¸…å”±å‰§å’å¹è°ƒ <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="æ¸…å”±å‰§å’å¹è°ƒ">0</span>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('åº·å¡”å¡”å’å¹è°ƒ', this)">
                            åº·å¡”å¡”å’å¹è°ƒ <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="åº·å¡”å¡”å’å¹è°ƒ">0</span>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('è‰ºæœ¯æ­Œæ›²', this)">
                            è‰ºæœ¯æ­Œæ›² <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="è‰ºæœ¯æ­Œæ›²">0</span>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('ç‹¬å”±ç‰‡æ®µ/é€‰æ®µ', this)">
                            ç‹¬å”±ç‰‡æ®µ/é€‰æ®µ <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="ç‹¬å”±ç‰‡æ®µ/é€‰æ®µ">0</span>
                        </button>
                        
                        <div class="p-1 bg-light text-center small text-muted fw-bold border-top border-bottom">é‡å”±ä¸åˆå”±</div>
                        
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('æ­Œå‰§é‡å”±', this)">
                            æ­Œå‰§é‡å”± <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="æ­Œå‰§é‡å”±">0</span>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('æ¸…å”±å‰§é‡å”±', this)">
                            æ¸…å”±å‰§é‡å”± <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="æ¸…å”±å‰§é‡å”±">0</span>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('è‰ºæœ¯æ­Œæ›²é‡å”±', this)">
                            è‰ºæœ¯æ­Œæ›²é‡å”± <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="è‰ºæœ¯æ­Œæ›²é‡å”±">0</span>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('åˆå”±ä½œå“', this)">
                            åˆå”±ä½œå“ <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="åˆå”±ä½œå“">0</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="category-card shadow-sm">
                    <div class="cat-header bg-success bg-opacity-10 text-success">
                        ğŸ» å™¨ä¹ä½œå“ (Instrumental)
                    </div>
                    <div class="list-group list-group-flush category-group">
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('å™¨ä¹ç‹¬å¥', this)">
                            å™¨ä¹ç‹¬å¥ <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="å™¨ä¹ç‹¬å¥">0</span>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('å®¤å†…ä¹', this)">
                            å®¤å†…ä¹ <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="å®¤å†…ä¹">0</span>
                        </button>
                    </div>
                    <div class="mt-4 px-3 text-muted small text-center">
                        <hr>
                        ç‚¹å‡»åˆ†ç±»è‡ªåŠ¨è·³è½¬è‡³ä¸‹æ–¹åˆ—è¡¨
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="category-card shadow-sm">
                    <div class="cat-header bg-danger bg-opacity-10 text-danger">
                        ğŸ¼ æ€»è°± (Full Scores)
                    </div>
                    <div class="list-group list-group-flush category-group">
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('æ­Œå‰§æ€»è°±', this)">
                            æ­Œå‰§æ€»è°± <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="æ­Œå‰§æ€»è°±">0</span>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('ç®¡å¼¦ä¹/äº¤å“æ›²', this)">
                            ç®¡å¼¦ä¹/äº¤å“æ›² <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="ç®¡å¼¦ä¹/äº¤å“æ›²">0</span>
                        </button>
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('åå¥æ›²æ€»è°±', this)">
                            åå¥æ›²æ€»è°± <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="åå¥æ›²æ€»è°±">0</span>
                        </button>
                        
                        <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('å®—æ•™å£°ä¹ä½œå“æ€»è°±', this)">
                            <div>
                                å®—æ•™å£°ä¹ä½œå“æ€»è°±
                                <div class="small text-muted" style="font-size: 0.65rem; font-weight: normal; margin-top: 2px; line-height: 1.2;">
                                    (æ¸…å”±å‰§ã€åº·å¡”å¡”ã€å¼¥æ’’ã€å®‰é­‚æ›²ç­‰)
                                </div>
                            </div>
                            <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="å®—æ•™å£°ä¹ä½œå“æ€»è°±">0</span>
                        </button>
                        </div>
                     <div class="mt-3 list-group list-group-flush category-group">
                         <div class="p-1 bg-light text-center small text-muted fw-bold border-top border-bottom">å…¶ä»–</div>
                         <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="filterCategory('å…¶ä»–', this)">
                            ğŸ“š å…¶ä»– <span class="badge bg-secondary bg-opacity-10 text-dark count-badge" data-cat="å…¶ä»–">0</span>
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="container content-section" id="mainContentArea">
        
        <div class="card shadow-sm border-0 mb-4 bg-light">
            <div class="card-body py-2">
                <div class="row align-items-center g-2">
                    <div class="col-md-auto fw-bold text-secondary">
                        ğŸŒªï¸ äºŒçº§ç­›é€‰:
                    </div>
                    <div class="col-md-3">
                        <input class="form-control form-control-sm" list="composerOptions" id="composerInput" placeholder="ä½œæ›²å®¶ (å¦‚: Mozart)..." oninput="applyFilters()">
                        <datalist id="composerOptions"></datalist>
                    </div>
                    <div class="col-md-3">
                        <input class="form-control form-control-sm" list="voiceOptions" id="voiceInput" placeholder="ç¼–åˆ¶/ä¹å™¨ (å¦‚: Soprano)..." oninput="applyFilters()">
                        <datalist id="voiceOptions"></datalist>
                    </div>
                    <div class="col-md-2">
                        <select id="languageSelect" class="form-select form-select-sm" onchange="applyFilters()">
                            <option value="all">æ‰€æœ‰è¯­è¨€</option>
                        </select>
                    </div>
                    <div class="col-md-auto ms-auto">
                         <button class="btn btn-sm btn-outline-secondary" onclick="resetFilters()">ğŸ”„ é‡ç½® / æŸ¥çœ‹å…¨éƒ¨</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div id="recentSection" class="mb-5">
                    <h5 class="mb-3 text-primary border-bottom pb-2">ğŸ†• æœ€è¿‘å…¥åº“</h5>
                    <div class="row row-cols-1 row-cols-md-3 g-3" id="recentList"></div>
                </div>

                <div id="listSection">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 id="listTitle" class="fw-bold">ğŸ“š æ‰€æœ‰èµ„æº</h4>
                        <span class="badge bg-secondary" id="filteredCount">0 é¦–</span>
                    </div>
                    
                    <div class="card shadow-sm border-0">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light text-secondary small text-uppercase">
                                    <tr>
                                        <th width="40%" class="ps-4">æ›²å / ä½œå“</th>
                                        <th width="20%">ä½œæ›²å®¶</th>
                                        <th width="10%">è¯­è¨€</th>
                                        <th width="15%">åˆ†ç±»</th>
                                        <th class="text-end pe-4">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="mainTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="noResult" class="text-center p-5 text-muted" style="display:none;">
                        <div class="fs-1 mb-3">ğŸ§</div>
                        <h4>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä¹è°±</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container text-center">
            <h5 class="text-white mb-3">äºèŒ‚åŒçš„ä¹è°±åº“</h5>
            <p class="mb-3 text-warning">ğŸ‰ æœ¬ç«™èµ„æºä»…ä¾›ä¸ªäººå­¦ä¹ äº¤æµï¼Œä¸¥ç¦å•†ç”¨</p>
            <hr style="border-color: #495057; width: 50%; margin: 1rem auto;">
            <p class="small text-muted mb-0">
                å¦‚æœå‘ç°ä¾µæƒï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼ˆäºèŒ‚åŒï¼‰ç«‹å³åˆ é™¤ã€‚<br>
                &copy; 2023-2025 Yu Maotong. All Rights Reserved.
            </p>
        </div>
    </footer>

    <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="height: 90vh;">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">ä¹è°±è¯¦æƒ…</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="row h-100 g-0">
                        <div class="col-md-3 p-4 bg-light border-end overflow-auto">
                            <span class="badge bg-primary mb-2" id="mCategory"></span>
                            <h3 id="mTitle" class="mb-3 fw-bold text-dark"></h3>
                            <p class="mb-3"><strong class="text-muted">æ‰€å±ä½œå“ï¼š</strong><br><span id="mWork" class="fs-5">-</span></p>
                            <div class="card mb-3 border-0 shadow-sm">
                                <ul class="list-group list-group-flush small">
                                    <li class="list-group-item">ğŸ‘¤ <strong>ä½œæ›²å®¶ï¼š</strong> <span id="mComposer"></span></li>
                                    <li class="list-group-item">ğŸ—£ï¸ <strong>è¯­è¨€ï¼š</strong> <span id="mLanguage"></span></li>
                                    <li class="list-group-item">ğŸ¹ <strong>è°ƒæ€§ï¼š</strong> <span id="mTonality"></span></li>
                                    <li class="list-group-item">ğŸ‘¥ <strong>ç¼–åˆ¶ï¼š</strong> <span id="mVoice"></span></li>
                                    <li class="list-group-item">ğŸ“… <strong>æ”¶å½•æ—¥æœŸï¼š</strong> <span id="mDate"></span></li>
                                </ul>
                            </div>
                            <a id="mDownload" href="#" class="btn btn-success w-100 py-2 fw-bold shadow-sm" download>â¬‡ï¸ ä¸‹è½½ PDF/MIDI</a>
                            <div class="mt-4 pt-3 border-top text-center">
                                <small class="text-muted" style="font-size: 0.75rem;">ä»…ä¾›å­¦ä¹ ä½¿ç”¨ï¼Œä¸‹è½½åè¯·äº24å°æ—¶å†…åˆ é™¤</small>
                            </div>
                        </div>
                        <div class="col-md-9 bg-secondary position-relative">
                            <iframe id="mPreview" src="" width="100%" height="100%" style="border:none;"></iframe>
                            <div id="noPreview" class="d-flex flex-column align-items-center justify-content-center h-100 text-white" style="display:none;">
                                <div class="fs-1 mb-3">ğŸ“„</div>
                                <p class="fs-5">æ­¤æ–‡ä»¶æš‚ä¸æ”¯æŒé¢„è§ˆ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="logModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">ğŸ”” ç½‘ç«™è¿‘æœŸåŠ¨æ€</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="logBody"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/data.js"></script>
    
    <script>
        let filters = { category: 'all', composer: '', language: 'all', voice: '', search: '' };

        document.addEventListener('DOMContentLoaded', () => {
            if (typeof musicData === 'undefined') {
                document.getElementById('recentList').innerHTML = 'è¯·å…ˆæ·»åŠ æ•°æ®';
                return;
            }
            initStatsAndDropdowns();
            renderRecent();
            applyFilters();
            
            const handleSearch = (e) => {
                filters.search = e.target.value.toLowerCase();
                if(filters.search.length > 0) {
                     document.getElementById('mainContentArea').scrollIntoView({ behavior: 'smooth' });
                }
                applyFilters();
            };
            document.getElementById('searchInput').addEventListener('input', handleSearch);
        });

        function initStatsAndDropdowns() {
            document.getElementById('statTotal').innerText = musicData.length;
            const composers = [...new Set(musicData.map(m => m.composer).filter(c => c))].sort((a, b) => a.localeCompare(b));
            const languages = [...new Set(musicData.map(m => m.language).filter(l => l))].sort();
            const voiceTypes = [...new Set(musicData.map(m => m.voice_types).filter(v => v))].sort();

            document.getElementById('statComposer').innerText = composers.length;
            
            const composerDataList = document.getElementById('composerOptions');
            composers.forEach(c => { composerDataList.innerHTML += `<option value="${c}">`; });
            const langSelect = document.getElementById('languageSelect');
            languages.forEach(l => { langSelect.innerHTML += `<option value="${l}">${l}</option>`; });
            const voiceDataList = document.getElementById('voiceOptions');
            voiceTypes.forEach(v => { voiceDataList.innerHTML += `<option value="${v}">`; });

            document.querySelectorAll('.count-badge').forEach(badge => {
                const cat = badge.getAttribute('data-cat');
                const count = musicData.filter(m => m.category === cat).length;
                badge.innerText = count;
                if(count === 0) badge.classList.add('opacity-50');
            });
        }

        function applyFilters() {
            filters.composer = document.getElementById('composerInput').value;
            filters.language = document.getElementById('languageSelect').value;
            filters.voice = document.getElementById('voiceInput').value;

            const result = musicData.filter(item => {
                const matchCat = filters.category === 'all' || item.category === filters.category;
                const matchComp = filters.composer === '' || item.composer.toLowerCase().includes(filters.composer.toLowerCase());
                const matchLang = filters.language === 'all' || item.language === filters.language;
                const matchVoice = filters.voice === '' || (item.voice_types && item.voice_types.toLowerCase().includes(filters.voice.toLowerCase()));
                const matchSearch = item.title.toLowerCase().includes(filters.search) || 
                                    item.composer.toLowerCase().includes(filters.search) ||
                                    (item.work && item.work.toLowerCase().includes(filters.search));
                return matchCat && matchComp && matchLang && matchVoice && matchSearch;
            });
            renderTable(result);
            const isFiltering = filters.search || filters.composer || filters.language !== 'all' || filters.voice || filters.category !== 'all';
            document.getElementById('recentSection').style.display = isFiltering ? 'none' : 'block';
        }

        function renderTable(data) {
            const tbody = document.getElementById('mainTableBody');
            const noResult = document.getElementById('noResult');
            document.getElementById('filteredCount').innerText = data.length + ' é¦–';
            if (data.length === 0) {
                tbody.innerHTML = '';
                noResult.style.display = 'block';
                return;
            }
            noResult.style.display = 'none';

            let html = '';
            data.forEach(item => {
                // === æ ¸å¿ƒä¿®æ”¹ï¼šæ ¹æ®åˆ†ç±»åˆ†é…é¢œè‰² Class ===
                let badgeClass = 'badge-other'; // é»˜è®¤ç°è‰²
                
                // çº¢è‰²ç³»ï¼šæ­Œå‰§å’å¹è°ƒ
                if(item.category.includes('æ­Œå‰§å’å¹è°ƒ')) badgeClass = 'badge-opera';
                // è“è‰²ç³»ï¼šè‰ºæœ¯æ­Œæ›²
                else if(item.category.includes('è‰ºæœ¯æ­Œæ›²') && !item.category.includes('é‡å”±')) badgeClass = 'badge-artsong';
                // ç´«è‰²ç³»ï¼šå®—æ•™/æ¸…å”±å‰§/åº·å¡”å¡”çš„ç‹¬å”±
                else if(item.category.includes('æ¸…å”±å‰§å’å¹è°ƒ') || item.category.includes('åº·å¡”å¡”å’å¹è°ƒ') || item.category.includes('ç‹¬å”±ç‰‡æ®µ')) badgeClass = 'badge-sacred';
                // å½©è‰²ç³»ï¼šä»»ä½•é‡å”±
                else if(item.category.includes('é‡å”±')) badgeClass = 'badge-ensemble';
                // ç»¿è‰²ç³»ï¼šåˆå”±
                else if(item.category.includes('åˆå”±')) badgeClass = 'badge-choral';
                // æ©™è‰²ç³»ï¼šå™¨ä¹/å®¤å†…ä¹
                else if(item.category.includes('å™¨ä¹') || item.category.includes('å®¤å†…ä¹')) badgeClass = 'badge-inst';
                // æ·±è‰²ç³»ï¼šæ€»è°±
                else if(item.category.includes('æ€»è°±') || item.category.includes('äº¤å“')) badgeClass = 'badge-score';

                let tonalityBadge = '';
                if(item.tonality) tonalityBadge = `<span class="badge bg-warning text-dark ms-2 opacity-75" style="font-size:0.7rem">${item.tonality}</span>`;
                let voiceBadge = '';
                if(item.voice_types) voiceBadge = `<span class="badge bg-dark bg-opacity-75 ms-1" style="font-size:0.7rem">${item.voice_types}</span>`;

                html += `
                <tr onclick="openDetail(${item.id})" class="hover-row">
                    <td class="ps-4">
                        <div class="fw-bold text-dark">
                            ${item.title} ${tonalityBadge} ${voiceBadge}
                        </div>
                        ${item.work ? `<small class="text-muted">ã€Š${item.work}ã€‹</small>` : ''}
                    </td>
                    <td><span class="fw-medium">${item.composer}</span></td>
                    <td>${item.language ? `<span class="badge bg-secondary bg-opacity-10 text-secondary">${item.language}</span>` : '-'}</td>
                    <td><span class="badge badge-custom ${badgeClass}">${item.category}</span></td>
                    <td class="text-end pe-4">
                        <button class="btn btn-sm btn-outline-primary rounded-pill px-3">æŸ¥çœ‹</button>
                    </td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        function renderRecent() {
            const list = document.getElementById('recentList');
            const recents = musicData.slice(0, 3);
            let html = '';
            recents.forEach(item => {
                html += `
                <div class="col">
                    <div class="card h-100 hover-card border-0 bg-white shadow-sm cursor-pointer" onclick="openDetail(${item.id})">
                        <div class="card-body">
                            <span class="badge bg-light text-muted mb-2">${item.category}</span>
                            <h6 class="card-title text-truncate fw-bold text-dark">${item.title}</h6>
                            <p class="card-text small text-secondary mb-0">${item.composer}</p>
                        </div>
                    </div>
                </div>`;
            });
            list.innerHTML = html;
        }

        window.filterCategory = function(cat, btn) {
            filters.category = cat;
            document.querySelectorAll('.category-group button').forEach(b => {
                b.classList.remove('active-cat');
            });
            if (cat !== 'all') {
                btn.classList.add('active-cat');
            }
            document.getElementById('listTitle').innerText = cat === 'all' ? 'ğŸ“š æ‰€æœ‰èµ„æº' : `ğŸ“‚ ${cat}`;
            document.getElementById('mainContentArea').scrollIntoView({ behavior: 'smooth' });
            applyFilters();
        }

        window.resetFilters = function() {
            filters = { category: 'all', composer: '', language: 'all', voice: '', search: '' };
            document.getElementById('searchInput').value = '';
            document.getElementById('composerInput').value = '';
            document.getElementById('languageSelect').value = 'all';
            document.getElementById('voiceInput').value = '';
            document.querySelectorAll('.category-group button').forEach(b => {
                b.classList.remove('active-cat');
            });
            document.getElementById('listTitle').innerText = 'ğŸ“š æ‰€æœ‰èµ„æº';
            document.getElementById('mainContentArea').scrollIntoView({ behavior: 'smooth' });
            applyFilters();
        }

        window.openDetail = function(id) {
            const item = musicData.find(m => m.id === id);
            if (!item) return;
            document.getElementById('mTitle').innerText = item.title;
            document.getElementById('mWork').innerText = item.work || '-';
            document.getElementById('mComposer').innerText = item.composer;
            document.getElementById('mCategory').innerText = item.category;
            document.getElementById('mLanguage').innerText = item.language || '-';
            document.getElementById('mDate').innerText = item.date || '-';
            document.getElementById('mTonality').innerText = item.tonality || '-';
            let voiceInfo = '-';
            if(item.voice_count || item.voice_types) voiceInfo = `${item.voice_count || ''} ${item.voice_types ? '('+item.voice_types+')' : ''}`;
            document.getElementById('mVoice').innerText = voiceInfo;
            const filePath = `scores/${item.filename}`;
            document.getElementById('mDownload').href = filePath;
            const previewFrame = document.getElementById('mPreview');
            const noPreview = document.getElementById('noPreview');
            if (item.filename.toLowerCase().endsWith('.pdf')) {
                previewFrame.src = filePath;
                previewFrame.style.display = 'block';
                noPreview.style.display = 'none';
            } else {
                previewFrame.style.display = 'none';
                noPreview.style.display = 'flex';
            }
            new bootstrap.Modal(document.getElementById('detailModal')).show();
        }

        window.showLogModal = function() {
            const body = document.getElementById('logBody');
            if (typeof changeLog === 'undefined' || changeLog.length === 0) {
                body.innerHTML = '<p class="text-muted text-center my-4">æš‚æ— åŠ¨æ€è®°å½•</p>';
            } else {
                let html = '<ul class="list-group list-group-flush">';
                changeLog.forEach(log => {
                    let badgeClass = 'bg-secondary';
                    if (log.type === 'add') badgeClass = 'bg-success';
                    if (log.type === 'update') badgeClass = 'bg-primary';
                    if (log.type === 'delete') badgeClass = 'bg-danger';
                    let typeText = 'æœªçŸ¥';
                    if (log.type === 'add') typeText = 'æ–°å¢';
                    if (log.type === 'update') typeText = 'æ›´æ–°';
                    if (log.type === 'delete') typeText = 'åˆ é™¤';
                    html += `
                    <li class="list-group-item d-flex justify-content-between align-items-start px-0">
                        <div class="ms-2 me-auto">
                            <div class="fw-bold small text-muted mb-1">${log.date}</div>
                            ${log.msg}
                        </div>
                        <span class="badge ${badgeClass} rounded-pill">${typeText}</span>
                    </li>`;
                });
                html += '</ul>';
                body.innerHTML = html;
            }
            new bootstrap.Modal(document.getElementById('logModal')).show();
        }
    </script>
</body>
</html>